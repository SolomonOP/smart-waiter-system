<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Smart Waiter</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Socket.io -->
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    
    <style>
        :root {
            --primary-color: #667eea;
            --primary-dark: #5a67d8;
            --secondary-color: #764ba2;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --light-color: #f8fafc;
            --dark-color: #1e293b;
            --gray-color: #64748b;
        }
        
        body {
            background-color: #f1f5f9;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            min-height: 100vh;
        }
        
        .sidebar {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            min-height: 100vh;
            color: white;
            position: fixed;
            width: 260px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            z-index: 1000;
        }
        
        .sidebar-brand {
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .sidebar-menu a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            display: flex;
            align-items: center;
            padding: 12px 20px;
            margin: 4px 10px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .sidebar-menu a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-weight: 500;
        }
        
        .sidebar-menu i {
            margin-right: 12px;
            font-size: 18px;
            width: 24px;
        }
        
        .main-content {
            margin-left: 260px;
            padding: 20px;
            min-height: 100vh;
        }
        
        .navbar {
            background: white;
            border-radius: 12px;
            padding: 15px 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            height: 100%;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .stat-icon.revenue { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
        .stat-icon.customers { background: linear-gradient(135deg, #10b981, #34d399); color: white; }
        .stat-icon.orders { background: linear-gradient(135deg, #f59e0b, #fbbf24); color: white; }
        .stat-icon.tables { background: linear-gradient(135deg, #8b5cf6, #a78bfa); color: white; }
        
        .stat-number {
            font-size: 28px;
            font-weight: 700;
            color: var(--dark-color);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--gray-color);
            font-size: 14px;
            font-weight: 500;
        }
        
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }
        
        .card-header {
            background: white;
            border-bottom: 1px solid #e2e8f0;
            padding: 20px;
            border-radius: 12px 12px 0 0 !important;
        }
        
        .card-title {
            color: var(--dark-color);
            font-weight: 600;
            margin: 0;
        }
        
        .table-container {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .table {
            margin: 0;
        }
        
        .table thead th {
            background: #f8fafc;
            border-bottom: 2px solid #e2e8f0;
            padding: 15px;
            font-weight: 600;
            color: var(--dark-color);
        }
        
        .table tbody td {
            padding: 15px;
            vertical-align: middle;
            border-color: #e2e8f0;
        }
        
        .table tbody tr:hover {
            background-color: #f8fafc;
        }
        
        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 500;
            font-size: 12px;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            height: 100%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .section-content {
            display: none;
        }
        
        .section-content.active {
            display: block;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.3);
        }
        
        .btn-outline-primary {
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-outline-primary:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(102, 126, 234, 0.3);
        }
        
        .form-control, .form-select {
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px 15px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .modal-content {
            border-radius: 12px;
            border: none;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }
        
        .modal-header {
            border-bottom: 1px solid #e2e8f0;
            padding: 20px;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            border-top: 1px solid #e2e8f0;
            padding: 20px;
        }
        
        @media (max-width: 992px) {
            .sidebar {
                width: 70px;
            }
            
            .sidebar .menu-text {
                display: none;
            }
            
            .sidebar-brand .brand-text {
                display: none;
            }
            
            .main-content {
                margin-left: 70px;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .main-content {
                margin-left: 0;
                padding: 15px;
            }
            
            .navbar {
                border-radius: 0;
                margin: -20px -20px 20px -20px;
            }
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 9999;
            backdrop-filter: blur(5px);
        }
        
        .menu-item-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }
        
        .menu-item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .table-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .table-card.selected {
            border-color: var(--primary-color);
            background: rgba(102, 126, 234, 0.05);
        }
        
        .table-card.occupied {
            background: linear-gradient(135deg, #fecaca, #fca5a5);
            color: #7f1d1d;
        }
        
        .table-card.available {
            background: linear-gradient(135deg, #bbf7d0, #86efac);
            color: #14532d;
        }
        
        .table-card.reserved {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #78350f;
        }
        
        .staff-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .staff-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        
        .staff-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: 600;
            margin: 0 auto 15px;
        }
        
        .filter-controls {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-brand">
            <div class="d-flex align-items-center">
                <i class="bi bi-cup-hot-fill fs-4"></i>
                <span class="brand-text ms-2 fs-5 fw-bold">Smart Waiter</span>
            </div>
            <div class="text-white-50 small mt-2">Admin Dashboard</div>
        </div>
        
        <div class="sidebar-menu">
            <a href="#" onclick="showSection('dashboard')" class="active">
                <i class="bi bi-speedometer2"></i>
                <span class="menu-text">Dashboard</span>
            </a>
            <a href="#" onclick="showSection('menu-management')">
                <i class="bi bi-menu-button-wide"></i>
                <span class="menu-text">Menu Management</span>
            </a>
            <a href="#" onclick="showSection('table-management')">
                <i class="bi bi-table"></i>
                <span class="menu-text">Table Management</span>
            </a>
            <a href="#" onclick="showSection('staff-management')">
                <i class="bi bi-people"></i>
                <span class="menu-text">Staff Management</span>
            </a>
            <a href="#" onclick="showSection('sales-analytics')">
                <i class="bi bi-bar-chart"></i>
                <span class="menu-text">Sales Analytics</span>
            </a>
            <div class="mt-4 pt-3 border-top border-white-10 mx-3">
                <a href="#" onclick="logout()" class="text-danger">
                    <i class="bi bi-box-arrow-right"></i>
                    <span class="menu-text">Logout</span>
                </a>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Navbar -->
        <nav class="navbar">
            <div class="container-fluid">
                <div class="d-flex justify-content-between align-items-center w-100">
                    <div>
                        <h4 class="mb-0" id="pageTitle">Dashboard Overview</h4>
                        <small class="text-muted" id="lastUpdated"></small>
                    </div>
                    <div class="d-flex align-items-center">
                        <div class="me-3">
                            <i class="bi bi-bell fs-5 text-gray"></i>
                            <span class="badge bg-danger rounded-pill" style="font-size: 10px; position: relative; top: -10px; left: -5px;" id="notificationBadge">0</span>
                        </div>
                        <div class="dropdown">
                            <a href="#" class="d-flex align-items-center text-decoration-none dropdown-toggle" data-bs-toggle="dropdown">
                                <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                    <i class="bi bi-person-fill text-white"></i>
                                </div>
                                <div class="ms-2">
                                    <div class="fw-medium" id="adminName">Admin User</div>
                                    <div class="text-muted small">Administrator</div>
                                </div>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end shadow">
                                <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i> Profile</a></li>
                                <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i> Settings</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="#" onclick="logout()"><i class="bi bi-box-arrow-right me-2"></i> Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </nav>
        
        <!-- Dashboard Section -->
        <div id="dashboardSection" class="section-content active">
            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card">
                        <div class="stat-icon revenue">
                            <i class="bi bi-currency-dollar fs-4"></i>
                        </div>
                        <div class="stat-number" id="todayRevenue">$0.00</div>
                        <div class="stat-label">Today's Revenue</div>
                        <small class="text-muted">+12% from yesterday</small>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card">
                        <div class="stat-icon customers">
                            <i class="bi bi-people fs-4"></i>
                        </div>
                        <div class="stat-number" id="todayCustomers">0</div>
                        <div class="stat-label">Today's Customers</div>
                        <small class="text-muted">+5 from yesterday</small>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card">
                        <div class="stat-icon orders">
                            <i class="bi bi-cart fs-4"></i>
                        </div>
                        <div class="stat-number" id="todayOrders">0</div>
                        <div class="stat-label">Today's Orders</div>
                        <small class="text-muted">+8% from yesterday</small>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="stat-card">
                        <div class="stat-icon tables">
                            <i class="bi bi-table fs-4"></i>
                        </div>
                        <div class="stat-number" id="tablesOccupied">0/0</div>
                        <div class="stat-label">Tables Occupied</div>
                        <small class="text-muted">75% occupancy rate</small>
                    </div>
                </div>
            </div>
            
            <!-- Charts and Recent Orders -->
            <div class="row">
                <div class="col-lg-8 mb-4">
                    <div class="chart-container">
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <h5 class="card-title mb-0">Revenue Overview (Last 7 Days)</h5>
                            <select class="form-select w-auto" id="chartPeriod">
                                <option value="week">This Week</option>
                                <option value="month">This Month</option>
                                <option value="year">This Year</option>
                            </select>
                        </div>
                        <canvas id="revenueChart" height="250"></canvas>
                    </div>
                </div>
                <div class="col-lg-4 mb-4">
                    <div class="chart-container">
                        <h5 class="card-title mb-4">Order Status Distribution</h5>
                        <canvas id="statusChart" height="250"></canvas>
                    </div>
                </div>
            </div>
            
            <!-- Recent Orders -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">Recent Orders</h5>
                    <button class="btn btn-sm btn-outline-primary" onclick="loadDashboard()">
                        <i class="bi bi-arrow-clockwise"></i> Refresh
                    </button>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Order #</th>
                                    <th>Table</th>
                                    <th>Customer</th>
                                    <th>Amount</th>
                                    <th>Status</th>
                                    <th>Time</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="recentOrdersTable">
                                <tr>
                                    <td colspan="7" class="text-center py-5">
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                        <p class="mt-2 mb-0">Loading orders...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Menu Management Section -->
        <div id="menu-managementSection" class="section-content">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="mb-0">Menu Management</h4>
                <button class="btn btn-primary" onclick="showAddMenuItemModal()">
                    <i class="bi bi-plus-circle me-2"></i> Add New Item
                </button>
            </div>
            
            <div class="filter-controls">
                <div class="row g-3">
                    <div class="col-md-4">
                        <select class="form-select" id="menuCategoryFilter">
                            <option value="">All Categories</option>
                            <option value="appetizer">Appetizer</option>
                            <option value="main">Main Course</option>
                            <option value="dessert">Dessert</option>
                            <option value="drink">Drink</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <select class="form-select" id="menuStatusFilter">
                            <option value="">All Status</option>
                            <option value="available">Available</option>
                            <option value="unavailable">Unavailable</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <div class="input-group">
                            <input type="text" class="form-control" placeholder="Search items..." id="menuSearch">
                            <button class="btn btn-outline-secondary" type="button">
                                <i class="bi bi-search"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row" id="menuItemsContainer">
                <div class="col-12 text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 mb-0">Loading menu items...</p>
                </div>
            </div>
        </div>
        
        <!-- Table Management Section -->
        <div id="table-managementSection" class="section-content">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="mb-0">Table Management</h4>
                <div>
                    <button class="btn btn-outline-primary me-2" onclick="showAddTableModal()">
                        <i class="bi bi-plus-circle me-2"></i> Add Table
                    </button>
                    <button class="btn btn-primary" onclick="showBulkTableModal()">
                        <i class="bi bi-collection me-2"></i> Bulk Add
                    </button>
                </div>
            </div>
            
            <div class="filter-controls">
                <div class="row g-3">
                    <div class="col-md-3">
                        <select class="form-select" id="tableSectionFilter">
                            <option value="">All Sections</option>
                            <option value="main">Main Hall</option>
                            <option value="terrace">Terrace</option>
                            <option value="private">Private Room</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="tableStatusFilter">
                            <option value="">All Status</option>
                            <option value="available">Available</option>
                            <option value="occupied">Occupied</option>
                            <option value="reserved">Reserved</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <select class="form-select" id="tableCapacityFilter">
                            <option value="">All Capacities</option>
                            <option value="2">2 Seats</option>
                            <option value="4">4 Seats</option>
                            <option value="6">6 Seats</option>
                            <option value="8">8+ Seats</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <button class="btn btn-outline-secondary w-100" onclick="loadTables()">
                            <i class="bi bi-filter me-2"></i> Apply Filters
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="row" id="tablesContainer">
                <div class="col-12 text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 mb-0">Loading tables...</p>
                </div>
            </div>
        </div>
        
        <!-- Staff Management Section -->
        <div id="staff-managementSection" class="section-content">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="mb-0">Staff Management</h4>
                <button class="btn btn-primary" onclick="showAddStaffModal()">
                    <i class="bi bi-person-plus me-2"></i> Add Staff Member
                </button>
            </div>
            
            <div class="row" id="staffContainer">
                <div class="col-12 text-center py-5">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2 mb-0">Loading staff data...</p>
                </div>
            </div>
        </div>
        
        <!-- Sales Analytics Section -->
        <div id="sales-analyticsSection" class="section-content">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 class="mb-0">Sales Analytics</h4>
                <div class="d-flex">
                    <input type="date" class="form-control me-2" id="fromDate">
                    <span class="align-self-center me-2">to</span>
                    <input type="date" class="form-control me-2" id="toDate">
                    <button class="btn btn-primary" onclick="loadSalesAnalytics()">
                        <i class="bi bi-calendar-check me-2"></i> Apply
                    </button>
                </div>
            </div>
            
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <div class="stat-card">
                        <div class="stat-label">Total Revenue</div>
                        <div class="stat-number" id="totalRevenue">$0.00</div>
                        <small class="text-muted" id="revenueChange">0% from previous period</small>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="stat-card">
                        <div class="stat-label">Total Orders</div>
                        <div class="stat-number" id="totalOrders">0</div>
                        <small class="text-muted" id="ordersChange">0% from previous period</small>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="stat-card">
                        <div class="stat-label">Average Order Value</div>
                        <div class="stat-number" id="averageOrder">$0.00</div>
                        <small class="text-muted" id="avgOrderChange">0% from previous period</small>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="stat-card">
                        <div class="stat-label">Top Selling Category</div>
                        <div class="stat-number" id="topCategory">N/A</div>
                        <small class="text-muted" id="topCategorySales">0 items sold</small>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-lg-8 mb-4">
                    <div class="chart-container">
                        <h5 class="card-title mb-4">Sales Trend</h5>
                        <canvas id="salesTrendChart" height="300"></canvas>
                    </div>
                </div>
                <div class="col-lg-4 mb-4">
                    <div class="chart-container">
                        <h5 class="card-title mb-4">Category Distribution</h5>
                        <canvas id="categoryChart" height="300"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">Top Selling Items</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table" id="topItemsTable">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Category</th>
                                    <th>Quantity Sold</th>
                                    <th>Revenue</th>
                                    <th>Rating</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="5" class="text-center py-5">Loading top items...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Add Menu Item Modal -->
    <div class="modal fade" id="addMenuItemModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Menu Item</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addMenuItemForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Item Name</label>
                                <input type="text" class="form-control" name="name" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Category</label>
                                <select class="form-select" name="category" required>
                                    <option value="">Select Category</option>
                                    <option value="appetizer">Appetizer</option>
                                    <option value="main">Main Course</option>
                                    <option value="dessert">Dessert</option>
                                    <option value="drink">Drink</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Price</label>
                                <input type="number" class="form-control" name="price" step="0.01" min="0" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Preparation Time (minutes)</label>
                                <input type="number" class="form-control" name="preparationTime" min="1" required>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" name="description" rows="3"></textarea>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Image URL</label>
                                <input type="url" class="form-control" name="image" placeholder="https://example.com/image.jpg">
                            </div>
                            <div class="col-md-6 mb-3">
                                <div class="form-check form-switch mt-4">
                                    <input class="form-check-input" type="checkbox" name="isAvailable" checked>
                                    <label class="form-check-label">Available</label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveMenuItem()">Save Item</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Table Modal -->
    <div class="modal fade" id="addTableModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Table</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addTableForm">
                        <div class="mb-3">
                            <label class="form-label">Table Number</label>
                            <input type="number" class="form-control" name="tableNumber" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Capacity</label>
                            <input type="number" class="form-control" name="capacity" min="1" max="20" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Section</label>
                            <select class="form-select" name="section" required>
                                <option value="main">Main Hall</option>
                                <option value="terrace">Terrace</option>
                                <option value="private">Private Room</option>
                                <option value="outdoor">Outdoor</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Location</label>
                            <input type="text" class="form-control" name="location" placeholder="e.g., Near window">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveTable()">Save Table</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Bulk Add Tables Modal -->
    <div class="modal fade" id="bulkTableModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Bulk Add Tables</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="bulkTableForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Start Table Number</label>
                                <input type="number" class="form-control" name="startNumber" min="1" value="1" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Number of Tables</label>
                                <input type="number" class="form-control" name="tableCount" min="1" max="50" value="10" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Capacity per Table</label>
                                <input type="number" class="form-control" name="capacity" min="1" max="20" value="4" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Section</label>
                                <select class="form-select" name="section" required>
                                    <option value="main">Main Hall</option>
                                    <option value="terrace">Terrace</option>
                                    <option value="private">Private Room</option>
                                </select>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Location Prefix</label>
                                <input type="text" class="form-control" name="locationPrefix" placeholder="e.g., Section A">
                            </div>
                        </div>
                        <div class="alert alert-info">
                            <i class="bi bi-info-circle me-2"></i>
                            This will create tables with sequential numbers starting from the specified number.
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="bulkAddTables()">Create Tables</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add Staff Modal -->
    <div class="modal fade" id="addStaffModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add Staff Member</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addStaffForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label">First Name</label>
                                <input type="text" class="form-control" name="firstName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Last Name</label>
                                <input type="text" class="form-control" name="lastName" required>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" name="email" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-control" name="phone" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label">Role</label>
                                <select class="form-select" name="role" required>
                                    <option value="chef">Chef</option>
                                    <option value="waiter">Waiter</option>
                                    <option value="manager">Manager</option>
                                    <option value="cashier">Cashier</option>
                                </select>
                            </div>
                            <div class="col-12 mb-3">
                                <label class="form-label">Password</label>
                                <input type="password" class="form-control" name="password" required>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveStaff()">Add Staff</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Include utils.js -->
    <script src="../js/utils.js"></script>
    
    <script>
        // Initialize
        let revenueChart, statusChart, salesTrendChart, categoryChart;
        let selectedTables = [];
        let socket = null;
        
        // Application state
        const AppState = {
            currentSection: 'dashboard',
            menuItems: [],
            tables: [],
            staff: [],
            salesData: null,
            charts: {}
        };
        
        // Initialize application
        async function initApp() {
            try {
                Loading.show('Initializing dashboard...');
                
                // Check authentication
                if (!Auth.check('admin')) {
                    return;
                }
                
                const user = Auth.getUser();
                
                // Set admin name
                document.getElementById('adminName').textContent = `${user.firstName || 'Admin'} ${user.lastName || ''}`;
                
                // Update last updated time
                updateLastUpdated();
                
                // Initialize socket
                initSocket();
                
                // Load dashboard data
                await loadDashboard();
                
                // Setup date inputs
                setupDateInputs();
                
                // Auto-refresh dashboard every 60 seconds
                setInterval(async () => {
                    if (AppState.currentSection === 'dashboard') {
                        await loadDashboard();
                    }
                }, 60000);
                
                // Update time every minute
                setInterval(updateLastUpdated, 60000);
                
                Loading.hide();
                
            } catch (error) {
                Loading.hide();
                ErrorHandler.handle(error, 'initApp');
            }
        }
        
        // Initialize socket
        function initSocket() {
            try {
                SocketManager.connect();
                
                // Listen for events
                SocketManager.on('new-order', (order) => {
                    console.log('New order received:', order);
                    if (AppState.currentSection === 'dashboard') {
                        loadDashboard();
                    }
                    Toast.show(`New order #${order.orderNumber} for table ${order.tableNumber}`, 'info');
                    updateNotificationBadge();
                });
                
                SocketManager.on('order-status-change', (data) => {
                    console.log('Order status changed:', data);
                    if (AppState.currentSection === 'dashboard') {
                        loadDashboard();
                    }
                    Toast.show(`Order #${data.orderNumber} status updated to ${data.status}`, 'info');
                });
                
                SocketManager.on('service-request', (data) => {
                    console.log('Service request:', data);
                    Toast.show(`Service request from table ${data.tableNumber}`, 'warning');
                    updateNotificationBadge();
                });
                
            } catch (error) {
                console.error('Socket initialization error:', error);
            }
        }
        
        // Update last updated time
        function updateLastUpdated() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            document.getElementById('lastUpdated').textContent = `Last updated: ${timeString}`;
        }
        
        // Update notification badge
        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                const current = parseInt(badge.textContent) || 0;
                badge.textContent = current + 1;
                badge.style.display = current + 1 > 0 ? 'inline' : 'none';
            }
        }
        
        // Clear notifications
        function clearNotifications() {
            const badge = document.getElementById('notificationBadge');
            if (badge) {
                badge.textContent = '0';
                badge.style.display = 'none';
            }
        }
        
        // Setup date inputs
        function setupDateInputs() {
            const today = new Date();
            const weekAgo = new Date();
            weekAgo.setDate(today.getDate() - 7);
            
            document.getElementById('fromDate').value = weekAgo.toISOString().split('T')[0];
            document.getElementById('toDate').value = today.toISOString().split('T')[0];
        }
        
        // Show section
        async function showSection(sectionId) {
            try {
                Loading.show('Loading section...');
                
                // Update state
                AppState.currentSection = sectionId;
                
                // Update page title
                const titles = {
                    'dashboard': 'Dashboard Overview',
                    'menu-management': 'Menu Management',
                    'table-management': 'Table Management',
                    'staff-management': 'Staff Management',
                    'sales-analytics': 'Sales Analytics'
                };
                document.getElementById('pageTitle').textContent = titles[sectionId] || 'Dashboard';
                
                // Hide all sections
                document.querySelectorAll('.section-content').forEach(section => {
                    section.style.display = 'none';
                });
                
                // Show selected section
                const sectionElement = document.getElementById(`${sectionId}Section`);
                if (sectionElement) {
                    sectionElement.style.display = 'block';
                }
                
                // Update active menu
                document.querySelectorAll('.sidebar-menu a').forEach(link => {
                    link.classList.remove('active');
                });
                const activeLink = document.querySelector(`.sidebar-menu a[onclick*="${sectionId}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
                
                // Load data for section
                switch(sectionId) {
                    case 'dashboard':
                        await loadDashboard();
                        break;
                    case 'menu-management':
                        await loadMenuItems();
                        break;
                    case 'table-management':
                        await loadTables();
                        break;
                    case 'staff-management':
                        await loadStaff();
                        break;
                    case 'sales-analytics':
                        await loadSalesAnalytics();
                        break;
                }
                
                Loading.hide();
                
            } catch (error) {
                Loading.hide();
                ErrorHandler.handle(error, `showSection: ${sectionId}`);
            }
        }
        
        // Load dashboard data
        async function loadDashboard() {
            try {
                const token = Auth.getToken();
                
                // Load statistics
                const statsData = await API.get(CONFIG.API_ENDPOINTS.ADMIN_STATS, token);
                
                // Update statistics
                if (statsData.success && statsData.stats) {
                    const stats = statsData.stats;
                    document.getElementById('todayRevenue').textContent = `$${(stats.revenue?.today || 0).toFixed(2)}`;
                    document.getElementById('todayCustomers').textContent = stats.customers?.today || 0;
                    document.getElementById('todayOrders').textContent = stats.orders?.today || 0;
                    document.getElementById('tablesOccupied').textContent = 
                        `${stats.tables?.occupied || 0}/${stats.tables?.total || 0}`;
                }
                
                // Load recent orders
                try {
                    const ordersData = await API.get(CONFIG.API_ENDPOINTS.ADMIN_ORDERS_RECENT + '?limit=10', token);
                    
                    // Display recent orders
                    const ordersTable = document.getElementById('recentOrdersTable');
                    
                    if (ordersData.success && ordersData.orders && ordersData.orders.length > 0) {
                        ordersTable.innerHTML = '';
                        ordersData.orders.forEach(order => {
                            const row = `
                                <tr>
                                    <td>#${order.orderNumber || 'N/A'}</td>
                                    <td>${order.tableNumber || 'N/A'}</td>
                                    <td>${order.customerName || 'Walk-in'}</td>
                                    <td>$${(order.totalAmount || 0).toFixed(2)}</td>
                                    <td>
                                        <span class="badge bg-${getStatusColor(order.status)}">
                                            ${FormatUtils.formatOrderStatus(order.status)}
                                        </span>
                                    </td>
                                    <td>${FormatUtils.formatTime(order.createdAt)}</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline-primary" onclick="viewOrder('${order._id}')">
                                            <i class="bi bi-eye"></i>
                                        </button>
                                    </td>
                                </tr>
                            `;
                            ordersTable.innerHTML += row;
                        });
                    } else {
                        ordersTable.innerHTML = '<tr><td colspan="7" class="text-center py-4">No recent orders</td></tr>';
                    }
                } catch (orderError) {
                    console.warn('Failed to load orders:', orderError);
                    document.getElementById('recentOrdersTable').innerHTML = 
                        '<tr><td colspan="7" class="text-center py-4 text-muted">Failed to load orders</td></tr>';
                }
                
                // Load revenue data for chart
                try {
                    const revenueData = await API.get(CONFIG.API_ENDPOINTS.ADMIN_REVENUE_WEEKLY, token);
                    createCharts(revenueData);
                } catch (chartError) {
                    console.warn('Chart error, using demo:', chartError);
                    createDemoCharts();
                }
                
                // Clear notifications on dashboard load
                clearNotifications();
                
                updateLastUpdated();
                
            } catch (error) {
                ErrorHandler.handle(error, 'loadDashboard');
                createDemoCharts();
            }
        }
        
        // Get status color
        function getStatusColor(status) {
            switch(status) {
                case 'pending': return 'warning';
                case 'preparing': return 'info';
                case 'ready': return 'success';
                case 'completed': return 'secondary';
                case 'rejected': return 'danger';
                default: return 'dark';
            }
        }
        
        // Create charts
        function createCharts(revenueData) {
            const revenueCtx = document.getElementById('revenueChart');
            if (!revenueCtx) return;
            
            const statusCtx = document.getElementById('statusChart');
            if (!statusCtx) return;
            
            // Destroy existing charts
            if (AppState.charts.revenue) AppState.charts.revenue.destroy();
            if (AppState.charts.status) AppState.charts.status.destroy();
            
            // Revenue Chart
            AppState.charts.revenue = new Chart(revenueCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: revenueData.labels || ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Revenue ($)',
                        data: revenueData.data || [0, 0, 0, 0, 0, 0, 0],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Status Chart (demo data)
            AppState.charts.status = new Chart(statusCtx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Pending', 'Preparing', 'Ready', 'Completed'],
                    datasets: [{
                        data: [5, 3, 2, 10],
                        backgroundColor: [
                            '#ffc107',
                            '#17a2b8',
                            '#28a745',
                            '#6c757d'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // Create demo charts
        function createDemoCharts() {
            const revenueCtx = document.getElementById('revenueChart');
            const statusCtx = document.getElementById('statusChart');
            
            if (!revenueCtx || !statusCtx) return;
            
            // Destroy existing charts
            if (AppState.charts.revenue) AppState.charts.revenue.destroy();
            if (AppState.charts.status) AppState.charts.status.destroy();
            
            // Revenue Chart with demo data
            AppState.charts.revenue = new Chart(revenueCtx.getContext('2d'), {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Revenue ($)',
                        data: [1200, 1900, 1500, 2100, 1800, 2500, 2200],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Status Chart with demo data
            AppState.charts.status = new Chart(statusCtx.getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: ['Pending', 'Preparing', 'Ready', 'Completed'],
                    datasets: [{
                        data: [5, 3, 2, 10],
                        backgroundColor: [
                            '#ffc107',
                            '#17a2b8',
                            '#28a745',
                            '#6c757d'
                        ]
                    }]
                }
            });
        }
        
        // Load menu items
        async function loadMenuItems() {
            try {
                const token = Auth.getToken();
                const response = await API.get(CONFIG.API_ENDPOINTS.ADMIN_MENU, token);
                
                if (response.success && response.menuItems) {
                    AppState.menuItems = response.menuItems;
                    renderMenuItems(response.menuItems);
                } else {
                    document.getElementById('menuItemsContainer').innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-menu-up display-1 text-muted"></i>
                            <p class="mt-3">No menu items found</p>
                            <button class="btn btn-primary" onclick="showAddMenuItemModal()">
                                <i class="bi bi-plus-circle me-2"></i> Add First Item
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                ErrorHandler.handle(error, 'loadMenuItems');
            }
        }
        
        // Render menu items
        function renderMenuItems(menuItems) {
            const container = document.getElementById('menuItemsContainer');
            if (!container) return;
            
            if (!menuItems || menuItems.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="bi bi-menu-up display-1 text-muted"></i>
                        <p class="mt-3">No menu items found</p>
                        <button class="btn btn-primary" onclick="showAddMenuItemModal()">
                            <i class="bi bi-plus-circle me-2"></i> Add First Item
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            menuItems.forEach(item => {
                const col = document.createElement('div');
                col.className = 'col-md-4 mb-4';
                col.innerHTML = `
                    <div class="card menu-item-card h-100">
                        <div class="position-relative">
                            ${item.image ? 
                                `<img src="${item.image}" class="card-img-top" alt="${item.name}" style="height: 180px; object-fit: cover;">` : 
                                `<div class="card-img-top bg-light d-flex align-items-center justify-content-center" style="height: 180px;">
                                    <i class="bi bi-cup-hot display-4 text-muted"></i>
                                </div>`
                            }
                            <span class="position-absolute top-0 end-0 m-2 badge ${item.isAvailable ? 'bg-success' : 'bg-danger'}">
                                ${item.isAvailable ? 'Available' : 'Unavailable'}
                            </span>
                        </div>
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title mb-0">${item.name}</h5>
                                <span class="badge bg-primary">${FormatUtils.formatCategory(item.category)}</span>
                            </div>
                            <p class="card-text text-muted small mb-3">${item.description || 'No description available'}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <h4 class="text-primary mb-0">$${item.price?.toFixed(2) || '0.00'}</h4>
                                <div>
                                    <button class="btn btn-sm btn-outline-primary me-1" onclick="editMenuItem('${item._id}')">
                                        <i class="bi bi-pencil"></i>
                                    </button>
                                    <button class="btn btn-sm btn-outline-danger" onclick="deleteMenuItem('${item._id}')">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="mt-3">
                                <small class="text-muted">
                                    <i class="bi bi-clock me-1"></i> ${item.preparationTime || 'N/A'} mins
                                </small>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            });
        }
        
        // Load tables
        async function loadTables() {
            try {
                const token = Auth.getToken();
                const response = await API.get(CONFIG.API_ENDPOINTS.ADMIN_TABLES, token);
                
                if (response.success && response.tables) {
                    AppState.tables = response.tables;
                    renderTables(response.tables);
                } else {
                    document.getElementById('tablesContainer').innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-table display-1 text-muted"></i>
                            <p class="mt-3">No tables found</p>
                            <button class="btn btn-primary" onclick="showAddTableModal()">
                                <i class="bi bi-plus-circle me-2"></i> Add First Table
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                ErrorHandler.handle(error, 'loadTables');
            }
        }
        
        // Render tables
        function renderTables(tables) {
            const container = document.getElementById('tablesContainer');
            if (!container) return;
            
            if (!tables || tables.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="bi bi-table display-1 text-muted"></i>
                        <p class="mt-3">No tables found</p>
                        <button class="btn btn-primary" onclick="showAddTableModal()">
                            <i class="bi bi-plus-circle me-2"></i> Add First Table
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            tables.forEach(table => {
                const col = document.createElement('div');
                col.className = 'col-md-3 mb-4';
                col.innerHTML = `
                    <div class="table-card ${table.status} ${selectedTables.includes(table._id) ? 'selected' : ''}" 
                         onclick="toggleTableSelection('${table._id}')">
                        <div class="mb-3">
                            <i class="bi bi-table fs-1"></i>
                        </div>
                        <h4 class="mb-2">Table ${table.tableNumber}</h4>
                        <div class="mb-2">
                            <span class="badge bg-${table.status === 'available' ? 'success' : table.status === 'occupied' ? 'danger' : 'warning'}">
                                ${FormatUtils.getTableStatusText(table.status)}
                            </span>
                        </div>
                        <div class="small mb-2">
                            <i class="bi bi-people me-1"></i> ${table.capacity} seats
                        </div>
                        <div class="small text-muted mb-3">
                            ${table.section ? FormatUtils.capitalize(table.section) : 'N/A'}
                        </div>
                        <div class="d-flex justify-content-center">
                            <button class="btn btn-sm btn-outline-primary me-1" onclick="editTable('${table._id}', event)">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteTable('${table._id}', event)">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            });
        }
        
        // Toggle table selection
        function toggleTableSelection(tableId) {
            const index = selectedTables.indexOf(tableId);
            if (index > -1) {
                selectedTables.splice(index, 1);
            } else {
                selectedTables.push(tableId);
            }
            loadTables(); // Re-render to update selection
        }
        
        // Load staff
        async function loadStaff() {
            try {
                const token = Auth.getToken();
                const response = await API.get(CONFIG.API_ENDPOINTS.ADMIN_STAFF, token);
                
                if (response.success && response.staff) {
                    AppState.staff = response.staff;
                    renderStaff(response.staff);
                } else {
                    document.getElementById('staffContainer').innerHTML = `
                        <div class="col-12 text-center py-5">
                            <i class="bi bi-people display-1 text-muted"></i>
                            <p class="mt-3">No staff members found</p>
                            <button class="btn btn-primary" onclick="showAddStaffModal()">
                                <i class="bi bi-person-plus me-2"></i> Add First Staff
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                ErrorHandler.handle(error, 'loadStaff');
            }
        }
        
        // Render staff
        function renderStaff(staff) {
            const container = document.getElementById('staffContainer');
            if (!container) return;
            
            if (!staff || staff.length === 0) {
                container.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="bi bi-people display-1 text-muted"></i>
                        <p class="mt-3">No staff members found</p>
                        <button class="btn btn-primary" onclick="showAddStaffModal()">
                            <i class="bi bi-person-plus me-2"></i> Add First Staff
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            staff.forEach(member => {
                const col = document.createElement('div');
                col.className = 'col-md-4 mb-4';
                col.innerHTML = `
                    <div class="staff-card">
                        <div class="staff-avatar">
                            ${member.firstName?.charAt(0) || 'S'}${member.lastName?.charAt(0) || 'M'}
                        </div>
                        <h5 class="text-center mb-2">${member.firstName} ${member.lastName}</h5>
                        <p class="text-center text-muted small mb-3">
                            <i class="bi bi-envelope me-1"></i> ${member.email}<br>
                            <i class="bi bi-telephone me-1"></i> ${member.phone}
                        </p>
                        <div class="text-center mb-3">
                            <span class="badge bg-${getRoleColor(member.role)}">
                                ${FormatUtils.capitalize(member.role)}
                            </span>
                        </div>
                        <div class="d-flex justify-content-center">
                            <button class="btn btn-sm btn-outline-primary me-2" onclick="editStaff('${member._id}')">
                                <i class="bi bi-pencil"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-outline-danger" onclick="deleteStaff('${member._id}')">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(col);
            });
        }
        
        // Get role color
        function getRoleColor(role) {
            switch(role) {
                case 'chef': return 'danger';
                case 'waiter': return 'info';
                case 'manager': return 'warning';
                case 'cashier': return 'success';
                default: return 'secondary';
            }
        }
        
        // Load sales analytics
        async function loadSalesAnalytics() {
            try {
                const token = Auth.getToken();
                const fromDate = document.getElementById('fromDate').value;
                const toDate = document.getElementById('toDate').value;
                
                // Load sales data
                const salesData = await API.get(`${CONFIG.API_ENDPOINTS.ADMIN_SALES}?from=${fromDate}&to=${toDate}`, token);
                
                if (salesData.success) {
                    AppState.salesData = salesData;
                    updateSalesAnalytics(salesData);
                }
            } catch (error) {
                ErrorHandler.handle(error, 'loadSalesAnalytics');
            }
        }
        
        // Update sales analytics display
        function updateSalesAnalytics(data) {
            // Update summary cards
            document.getElementById('totalRevenue').textContent = `$${(data.totalRevenue || 0).toFixed(2)}`;
            document.getElementById('totalOrders').textContent = data.totalOrders || 0;
            document.getElementById('averageOrder').textContent = `$${((data.totalRevenue || 0) / (data.totalOrders || 1)).toFixed(2)}`;
            document.getElementById('topCategory').textContent = data.topCategory || 'N/A';
            
            // Update change percentages (demo data)
            document.getElementById('revenueChange').textContent = '+12% from previous period';
            document.getElementById('ordersChange').textContent = '+8% from previous period';
            document.getElementById('avgOrderChange').textContent = '+5% from previous period';
            document.getElementById('topCategorySales').textContent = `${data.topCategoryCount || 0} items sold`;
            
            // Create charts
            createSalesCharts(data);
            
            // Update top items table
            updateTopItemsTable(data.topItems || []);
        }
        
        // Create sales charts
        function createSalesCharts(data) {
            const trendCtx = document.getElementById('salesTrendChart');
            const categoryCtx = document.getElementById('categoryChart');
            
            if (!trendCtx || !categoryCtx) return;
            
            // Destroy existing charts
            if (AppState.charts.salesTrend) AppState.charts.salesTrend.destroy();
            if (AppState.charts.category) AppState.charts.category.destroy();
            
            // Sales Trend Chart
            AppState.charts.salesTrend = new Chart(trendCtx.getContext('2d'), {
                type: 'bar',
                data: {
                    labels: data.dailySales?.map(d => d.date) || ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Daily Revenue ($)',
                        data: data.dailySales?.map(d => d.revenue) || [1200, 1900, 1500, 2100, 1800, 2500, 2200],
                        backgroundColor: '#667eea',
                        borderColor: '#5a67d8',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Category Distribution Chart
            AppState.charts.category = new Chart(categoryCtx.getContext('2d'), {
                type: 'pie',
                data: {
                    labels: data.categoryDistribution?.map(c => c.category) || ['Main Course', 'Drinks', 'Appetizers', 'Desserts'],
                    datasets: [{
                        data: data.categoryDistribution?.map(c => c.revenue) || [45, 25, 20, 10],
                        backgroundColor: [
                            '#667eea',
                            '#10b981',
                            '#f59e0b',
                            '#ef4444'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // Update top items table
        function updateTopItemsTable(items) {
            const table = document.getElementById('topItemsTable').querySelector('tbody');
            
            if (!items || items.length === 0) {
                table.innerHTML = '<tr><td colspan="5" class="text-center py-4">No data available</td></tr>';
                return;
            }
            
            table.innerHTML = '';
            
            items.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="d-flex align-items-center">
                            <span class="badge bg-primary me-2">${index + 1}</span>
                            ${item.name}
                        </div>
                    </td>
                    <td>${FormatUtils.formatCategory(item.category)}</td>
                    <td>${item.quantitySold || 0}</td>
                    <td>$${(item.revenue || 0).toFixed(2)}</td>
                    <td>
                        <span class="badge bg-${item.rating >= 4 ? 'success' : item.rating >= 3 ? 'warning' : 'danger'}">
                            ${item.rating?.toFixed(1) || 'N/A'}
                        </span>
                    </td>
                `;
                table.appendChild(row);
            });
        }
        
        // Modal functions
        function showAddMenuItemModal() {
            const modal = new bootstrap.Modal(document.getElementById('addMenuItemModal'));
            modal.show();
        }
        
        function showAddTableModal() {
            const modal = new bootstrap.Modal(document.getElementById('addTableModal'));
            modal.show();
        }
        
        function showBulkTableModal() {
            const modal = new bootstrap.Modal(document.getElementById('bulkTableModal'));
            modal.show();
        }
        
        function showAddStaffModal() {
            const modal = new bootstrap.Modal(document.getElementById('addStaffModal'));
            modal.show();
        }
        
        // Save functions
        async function saveMenuItem() {
            try {
                Loading.show('Saving menu item...');
                
                const form = document.getElementById('addMenuItemForm');
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                
                data.price = parseFloat(data.price);
                data.preparationTime = parseInt(data.preparationTime);
                data.isAvailable = data.isAvailable === 'on';
                
                const token = Auth.getToken();
                const response = await API.post(CONFIG.API_ENDPOINTS.ADMIN_MENU, data, token);
                
                if (response.success) {
                    Toast.show('Menu item added successfully!', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('addMenuItemModal')).hide();
                    form.reset();
                    await loadMenuItems();
                }
                
                Loading.hide();
            } catch (error) {
                Loading.hide();
                ErrorHandler.handle(error, 'saveMenuItem');
            }
        }
        
        async function saveTable() {
            try {
                Loading.show('Saving table...');
                
                const form = document.getElementById('addTableForm');
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                
                data.tableNumber = parseInt(data.tableNumber);
                data.capacity = parseInt(data.capacity);
                
                const token = Auth.getToken();
                const response = await API.post(CONFIG.API_ENDPOINTS.ADMIN_TABLES, data, token);
                
                if (response.success) {
                    Toast.show('Table added successfully!', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('addTableModal')).hide();
                    form.reset();
                    await loadTables();
                }
                
                Loading.hide();
            } catch (error) {
                Loading.hide();
                ErrorHandler.handle(error, 'saveTable');
            }
        }
        
        async function bulkAddTables() {
            try {
                Loading.show('Creating tables...');
                
                const form = document.getElementById('bulkTableForm');
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                
                data.startNumber = parseInt(data.startNumber);
                data.tableCount = parseInt(data.tableCount);
                data.capacity = parseInt(data.capacity);
                
                const token = Auth.getToken();
                const response = await API.post(CONFIG.API_ENDPOINTS.ADMIN_TABLES + '/bulk', data, token);
                
                if (response.success) {
                    Toast.show(`${data.tableCount} tables created successfully!`, 'success');
                    bootstrap.Modal.getInstance(document.getElementById('bulkTableModal')).hide();
                    form.reset();
                    await loadTables();
                }
                
                Loading.hide();
            } catch (error) {
                Loading.hide();
                ErrorHandler.handle(error, 'bulkAddTables');
            }
        }
        
        async function saveStaff() {
            try {
                Loading.show('Adding staff member...');
                
                const form = document.getElementById('addStaffForm');
                const formData = new FormData(form);
                const data = Object.fromEntries(formData);
                
                const token = Auth.getToken();
                const response = await API.post(CONFIG.API_ENDPOINTS.ADMIN_STAFF, data, token);
                
                if (response.success) {
                    Toast.show('Staff member added successfully!', 'success');
                    bootstrap.Modal.getInstance(document.getElementById('addStaffModal')).hide();
                    form.reset();
                    await loadStaff();
                }
                
                Loading.hide();
            } catch (error) {
                Loading.hide();
                ErrorHandler.handle(error, 'saveStaff');
            }
        }
        
        // Edit functions
        async function editMenuItem(itemId) {
            const item = AppState.menuItems.find(m => m._id === itemId);
            if (!item) return;
            
            // TODO: Implement edit modal
            Toast.show('Edit functionality coming soon!', 'info');
        }
        
        async function editTable(tableId) {
            const table = AppState.tables.find(t => t._id === tableId);
            if (!table) return;
            
            // TODO: Implement edit modal
            Toast.show('Edit functionality coming soon!', 'info');
        }
        
        async function editStaff(staffId) {
            const staff = AppState.staff.find(s => s._id === staffId);
            if (!staff) return;
            
            // TODO: Implement edit modal
            Toast.show('Edit functionality coming soon!', 'info');
        }
        
        // Delete functions
        async function deleteMenuItem(itemId) {
            if (!confirm('Are you sure you want to delete this menu item?')) return;
            
            try {
                Loading.show('Deleting menu item...');
                
                const token = Auth.getToken();
                const response = await API.delete(`${CONFIG.API_ENDPOINTS.ADMIN_MENU_ITEM(itemId)}`, token);
                
                if (response.success) {
                    Toast.show('Menu item deleted successfully!', 'success');
                    await loadMenuItems();
                }
                
                Loading.hide();
            } catch (error) {
                Loading.hide();
                ErrorHandler.handle(error, 'deleteMenuItem');
            }
        }
        
        async function deleteTable(tableId) {
            if (!confirm('Are you sure you want to delete this table?')) return;
            
            try {
                Loading.show('Deleting table...');
                
                const token = Auth.getToken();
                const response = await API.delete(`${CONFIG.API_ENDPOINTS.ADMIN_TABLES}/${tableId}`, token);
                
                if (response.success) {
                    Toast.show('Table deleted successfully!', 'success');
                    await loadTables();
                }
                
                Loading.hide();
            } catch (error) {
                Loading.hide();
                ErrorHandler.handle(error, 'deleteTable');
            }
        }
        
        async function deleteStaff(staffId) {
            if (!confirm('Are you sure you want to delete this staff member?')) return;
            
            try {
                Loading.show('Deleting staff member...');
                
                const token = Auth.getToken();
                const response = await API.delete(`${CONFIG.API_ENDPOINTS.ADMIN_STAFF_MEMBER(staffId)}`, token);
                
                if (response.success) {
                    Toast.show('Staff member deleted successfully!', 'success');
                    await loadStaff();
                }
                
                Loading.hide();
            } catch (error) {
                Loading.hide();
                ErrorHandler.handle(error, 'deleteStaff');
            }
        }
        
        // View order details
        function viewOrder(orderId) {
            // TODO: Implement order detail view
            Toast.show('Order detail view coming soon!', 'info');
        }
        
        // Logout
        function logout() {
            Auth.logout();
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Prevent event bubbling for table actions
        function editTable(tableId, event) {
            event.stopPropagation();
            editTable(tableId);
        }
        
        function deleteTable(tableId, event) {
            event.stopPropagation();
            deleteTable(tableId);
        }
    </script>
</body>
</html>